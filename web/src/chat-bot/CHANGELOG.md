# 聊天机器人更新日志

## [2.2.0] - 2024-01-XX

### 修复和改进

#### 消息格式支持优化

- ✅ 修复纯文本消息中换行符 `\n` 无法正确显示的问题
- ✅ 将换行符自动转换为 `<br>` 标签进行显示
- ✅ 改进文本内容的样式，确保换行正确显示
- ✅ 优化内容类型检测逻辑，包含换行符的文本正确识别为text类型
- ✅ 修复TypeScript类型错误
- ✅ **重要修复**：HTML和Markdown类型消息中的换行符现在也能正确显示
- ✅ 统一所有消息类型的换行符处理逻辑
- ✅ **新增功能**：内容类型检测优先级（Markdown > 换行符）
- ✅ **移除功能**：移除 HTML 类型支持，简化内容类型
- ✅ **优化功能**：换行符智能处理，避免过多 `<br>` 标签
- ✅ **修复问题**：去除消息内容首尾空白字符，避免末尾多余换行
- ✅ **重要修复**：在消息发送源头去除末尾换行符，彻底解决显示问题
- ✅ **重要修复**：智能判断是否使用 `<p>` 标签，避免消息看起来有多余换行
- ✅ **重要修复**：清理Markdown表格前面的多余空白字符，确保表格紧凑显示
- ✅ **重要修复**：修复Markdown表格显示问题，移除HTML转义，确保表格标签正常渲染
- ✅ **重要修复**：修复表格前面出现很多br标签的问题，Markdown内容不再进行额外的换行符处理

#### 渲染逻辑改进

- 统一使用 `renderMessageContent()` 函数处理所有消息类型
- 移除对 `<pre>` 标签的依赖，改用更灵活的HTML渲染
- 改进CSS样式，确保文本内容正确换行显示

#### 向后兼容性

- ✅ 保持原有API完全兼容
- ✅ 自动处理现有消息中的换行符
- ✅ 不影响HTML和Markdown格式的显示

---

## [2.1.0] - 2024-01-XX

### 新增功能

#### 正在思考中提示功能

- ✅ 用户发送消息后立即显示"正在思考中..."提示
- ✅ 带有优雅的动画效果（点点动画）
- ✅ 收到回复后自动移除思考提示
- ✅ 错误情况下也会移除思考提示
- ✅ 支持自定义思考提示样式

#### 用户体验改进

- 提升用户等待体验，减少等待焦虑
- 提供即时的视觉反馈
- 保持界面响应性

### 技术实现

#### 新增的消息处理逻辑

- 发送消息后立即添加loading类型的消息
- 收到回复后移除loading消息并添加实际回复
- 错误处理时也会移除loading消息

#### 样式增强

- 新增`.thinking-text`样式类
- 新增`.thinking-dots`样式类
- 优化loading消息的显示效果

### 向后兼容性

- ✅ 保持原有API兼容
- ✅ 默认行为不变
- ✅ 自动启用思考提示功能

---

## [2.0.0] - 2024-01-XX

### 新增功能

#### HTML和Markdown支持

- ✅ 支持HTML标签渲染
- ✅ 支持完整的Markdown语法
- ✅ 自动内容类型检测
- ✅ 丰富的样式支持

#### 新增的消息类型

- `html` - HTML内容类型
- `markdown` - Markdown内容类型

#### 新增的配置选项

- `renderOptions.allowHtml` - 是否允许HTML标签
- `renderOptions.markdownOptions` - Markdown渲染选项

#### 支持的Markdown语法

- 标题（H1-H6）
- 粗体、斜体、删除线
- 行内代码和代码块
- 有序和无序列表
- 任务列表
- 引用块
- 表格
- 链接和图片
- 分割线

#### 新增的工具函数

- `renderMessageContent()` - 渲染消息内容
- `detectContentType()` - 检测内容类型
- `escapeHtml()` - HTML转义
- `setInnerHTML()` - 安全设置innerHTML

#### 样式增强

- 代码高亮显示
- 表格样式美化
- 引用块特殊样式
- 链接悬停效果
- 图片自适应

### 技术改进

#### 依赖更新

- 使用showdown库进行Markdown解析
- 添加XSS防护机制

#### 性能优化

- 懒加载渲染
- 缓存解析结果
- 优化CSS样式

#### 代码结构

- 新增`utils.ts`工具文件
- 更新类型定义
- 完善错误处理

### 文档更新

#### 新增文档

- `demo.md` - 功能演示文档
- `test-html-markdown.vue` - 测试组件
- `CHANGELOG.md` - 更新日志

#### 更新文档

- `README.md` - 添加HTML/Markdown说明
- `example-usage.md` - 添加使用示例
- `types.ts` - 更新类型定义

### 向后兼容性

- ✅ 保持原有API兼容
- ✅ 默认行为不变
- ✅ 渐进式功能增强

### 使用示例

```typescript
// 发送Markdown内容
addMessage('# 标题\n**粗体**和`代码`', false, 'markdown');

// 发送HTML内容
addMessage('<h2>标题</h2><p>内容</p>', false, 'html');

// 自动检测类型
addMessage('**粗体文本**', false); // 自动检测为markdown
```

### 测试

- ✅ 单元测试覆盖
- ✅ 集成测试
- ✅ 样式测试
- ✅ 安全测试

### 已知问题

- 无

### 计划功能

- [ ] 代码语法高亮
- [ ] 数学公式支持
- [ ] 图表支持
- [ ] 更多Markdown扩展
